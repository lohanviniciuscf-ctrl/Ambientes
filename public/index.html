<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CRM</title>

<style>
:root{
  --bg:#0a192f;
  --card:#112240;
  --accent:#64ffda;
  --text:#e6f1ff;
}

/* BASE */
body{
  margin:0;
  font-family:Segoe UI, Arial;
  background:var(--bg);
  color:var(--text);
}

button,input{
  padding:7px;
  border:none;
  border-radius:6px;
  margin:4px 0;
}

button{
  background:var(--accent);
  font-weight:bold;
  cursor:pointer;
  color:#000;
}

.center{
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
}

.box{
  background:var(--card);
  padding:20px;
  border-radius:12px;
  width:320px;
  text-align:center;
}

header{
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.metrics,.consolidado{
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:10px;
  margin:10px 0;
}

.metric{
  background:var(--card);
  padding:10px;
  border-radius:10px;
  text-align:center;
}

.board{
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:10px;
}

.column{
  background:var(--card);
  padding:10px;
  border-radius:10px;
}

.lead{
  background:#020c1b;
  padding:8px;
  margin:6px 0;
  border-radius:6px;
  font-size:13px;
}

.atrasado{
  border:2px solid #ff4d4d;
}

.hidden{display:none}
small{opacity:.8}
</style>
</head>

<body>

<!-- AMBIENTE -->
<div id="envSelect" class="center">
  <div class="box">
    <h3>Escolha o ambiente</h3>
    <button onclick="selectEnv('Modelle Skin')">Modelle Skin</button>
    <button onclick="selectEnv('Cia & Arte')">Cia & Arte</button>
  </div>
</div>

<!-- LOGIN -->
<div id="loginScreen" class="center hidden">
  <div class="box">
    <button onclick="backToEnv()">â¬… Voltar</button>
    <h3 id="envTitle"></h3>
    <input id="user" placeholder="UsuÃ¡rio">
    <input id="pass" type="password" placeholder="Senha">
    <button onclick="login()">Entrar</button>
    <div id="loginError"></div>
  </div>
</div>

<!-- APP -->
<div id="app" class="hidden" style="padding:15px">

<header>
  <strong id="appTitle"></strong>
  <div>
    <button id="btnConsolidado" class="hidden" onclick="toggleConsolidado()">ðŸ“Š Consolidado</button>
    <button onclick="logout()">Sair</button>
  </div>
</header>

<div id="metrics" class="metrics"></div>
<div id="formArea"></div>
<div id="board" class="board"></div>

<!-- CONSOLIDADO MODELLE -->
<div id="consolidado" class="hidden">
  <h3>Consolidado do MÃªs</h3>
  <div class="consolidado">
    <div class="metric">Pedidos<br><strong id="cPed"></strong></div>
    <div class="metric">Total<br><strong id="cTotal"></strong></div>
    <div class="metric">ComissÃ£o (1%)<br><strong id="cCom"></strong></div>
  </div>
  <div id="listaMes"></div>
</div>

</div>

<script>
const users={
 Lohan:{pass:"D9f0da85",env:["Modelle Skin","Cia & Arte"]},
 marcus:{pass:"Elistray6001",env:["Cia & Arte"]},
 Queila:{pass:"alieuq79",env:["Modelle Skin"]}
};

let env=null,userAtual=null,leads=[];
const etapas=["Lead","Em andamento","Proposta","Fechado"];

function selectEnv(e){
 env=e;
 envSelect.classList.add("hidden");
 loginScreen.classList.remove("hidden");
 envTitle.innerText=e;

 /* TEMA MODELLE */
 if(e==="Modelle Skin"){
  document.documentElement.style.setProperty("--bg","#f5dcc6");        // pele
  document.documentElement.style.setProperty("--card","#e2b48c");     // caramelo
  document.documentElement.style.setProperty("--accent","#c68642");   // caramelo escuro
  document.documentElement.style.setProperty("--text","#000");        // letras pretas
 }
}

function backToEnv(){
 loginScreen.classList.add("hidden");
 envSelect.classList.remove("hidden");
}

function login(){
 if(users[user.value] && users[user.value].pass===pass.value && users[user.value].env.includes(env)){
  userAtual=user.value;
  loginScreen.classList.add("hidden");
  app.classList.remove("hidden");
  appTitle.innerText=env+" â€” "+userAtual;
  btnConsolidado.classList.toggle("hidden",env!=="Modelle Skin");
  load();
 }else loginError.innerText="Login invÃ¡lido";
}

function logout(){ location.reload(); }

function load(){
 leads=JSON.parse(localStorage.getItem(env+"_"+userAtual))||[];
 render();
}

function save(){
 localStorage.setItem(env+"_"+userAtual,JSON.stringify(leads));
}

function addLead(){
 if(env==="Modelle Skin"){
  leads.push({
    id:Date.now(),
    valor:+valor.value,
    desc:desc.value,
    data:Date.now()
  });
 }else{
  leads.push({
   id:Date.now(),
   nome:nome.value,
   valor:+valor.value,
   custo:+custo.value,
   prazo:+prazo.value,
   criado:Date.now(),
   status:etapas[0]
  });
 }
 save();render();
}

function toggleConsolidado(){
 consolidado.classList.toggle("hidden");
 board.classList.toggle("hidden");
}

function render(){
 metrics.innerHTML="";
 formArea.innerHTML="";
 board.innerHTML="";
 consolidado.classList.add("hidden");

 /* MODELLE */
 if(env==="Modelle Skin"){
  formArea.innerHTML=`
   <input id="desc" placeholder="DescriÃ§Ã£o do pedido">
   <input id="valor" type="number" placeholder="Valor do pedido">
   <button onclick="addLead()">Adicionar Pedido</button>
  `;

  let total=0;
  leads.forEach(l=>total+=l.valor);

  metrics.innerHTML=`
   <div class="metric">Pedidos<br><strong>${leads.length}</strong></div>
   <div class="metric">Total Vendido<br><strong>R$ ${total}</strong></div>
   <div class="metric">ComissÃ£o<br><strong>R$ ${(total*0.01).toFixed(2)}</strong></div>
  `;

  /* CARDS NORMAIS */
  board.innerHTML=leads.map(l=>`
    <div class="lead">
      <strong>${l.desc}</strong><br>
      Valor: R$ ${l.valor}<br>
      <small>Data: ${new Date(l.data).toLocaleDateString()}</small>
    </div>
  `).join("");

  /* CONSOLIDADO */
  const mesAtual=new Date().getMonth();
  const mesLeads=leads.filter(l=>new Date(l.data).getMonth()===mesAtual);

  const totalMes=mesLeads.reduce((a,b)=>a+b.valor,0);

  cPed.innerText=mesLeads.length;
  cTotal.innerText="R$ "+totalMes;
  cCom.innerText="R$ "+(totalMes*0.01).toFixed(2);

  listaMes.innerHTML=mesLeads.map(l=>`
    <div class="lead">
      <strong>${l.desc}</strong><br>
      Valor: R$ ${l.valor}<br>
      <small>Data: ${new Date(l.data).toLocaleDateString()}</small>
    </div>
  `).join("");
 }

 /* CIA & ARTE */
 else{
  formArea.innerHTML=`
   <input id="nome" placeholder="Cliente">
   <input id="valor" type="number" placeholder="Valor">
   <input id="custo" type="number" placeholder="Custo">
   <input id="prazo" type="number" placeholder="Prazo (dias)">
   <button onclick="addLead()">Adicionar Lead</button>
  `;

  let atraso=0;
  etapas.forEach(e=>{
   const col=document.createElement("div");
   col.className="column";
   col.innerHTML="<strong>"+e+"</strong>";
   col.ondragover=x=>x.preventDefault();
   col.ondrop=x=>{
    leads.find(l=>l.id==x.dataTransfer.getData("id")).status=e;
    save();render();
   };

   leads.filter(l=>l.status===e).forEach(l=>{
    const dias=Math.floor((Date.now()-l.criado)/86400000);
    const rest=l.prazo-dias;
    if(rest<0) atraso++;

    const d=document.createElement("div");
    d.className="lead"+(rest<0?" atrasado":"");
    d.draggable=true;
    d.ondragstart=x=>x.dataTransfer.setData("id",l.id);
    d.innerHTML=`
     ${l.nome}<br>
     R$ ${l.valor} | Lucro ${l.valor-l.custo}<br>
     <small>${rest>=0?rest+" dias":"ATRASADO"}</small>
    `;
    col.appendChild(d);
   });
   board.appendChild(col);
  });

  metrics.innerHTML=`
   <div class="metric">Leads<br><strong>${leads.length}</strong></div>
   <div class="metric">Atrasados<br><strong>${atraso}</strong></div>
  `;
 }
}
</script>

</body>
</html>
